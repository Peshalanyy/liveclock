<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EBL Time & Local Weather Widget</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      background-color: white;
      color: black;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        background-color: #0f172a;
        color: white;
      }
    }

    body {
      font-family: 'Menlo', 'Consolas', monospace;
    }
  </style>
</head>
<body class="h-screen flex items-center justify-center">
  <div class="flex items-center gap-4 text-xl slashed-zero tabular-nums" id="time-container">
    <span id="clock">EBL ‚Äî 00:00:00</span>
    <div class="flex h-3 w-3 justify-center items-center relative">
      <div class="h-3 w-3 bg-[#27FF63] rounded-full absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 animate-ping"></div>
      <div class="h-2 w-2 bg-[#27FF63] rounded-full absolute top-[60%] left-[60%] -translate-x-1/2 -translate-y-1/2"></div>
    </div>
    <span id="weather" class="text-inherit text-xl">Loading weather...</span>
  </div>

  <script>
    // Show Erbil time (UTC+3)
    function updateTime() {
      const now = new Date();
      const utc = now.getTime() + now.getTimezoneOffset() * 60000;
      const offset = 3 * 60 * 60000;
      const eblTime = new Date(utc + offset);

      const hours = String(eblTime.getHours()).padStart(2, '0');
      const minutes = String(eblTime.getMinutes()).padStart(2, '0');
      const seconds = String(eblTime.getSeconds()).padStart(2, '0');

      document.getElementById('clock').textContent = `EBL ‚Äî ${hours}:${minutes}:${seconds}`;
    }
    setInterval(updateTime, 1000);
    updateTime();

    // Fetch weather from Open-Meteo
    async function fetchWeather(lat, lon) {
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        const temp = Math.round(data.current_weather.temperature);
        const iconCode = data.current_weather.weathercode;

        const icons = {
          0: "‚òÄÔ∏è", 1: "üå§", 2: "‚õÖ", 3: "‚òÅÔ∏è",
          45: "üå´", 48: "üå´", 51: "üå¶", 61: "üåß",
          71: "‚ùÑÔ∏è", 95: "‚õà", 99: "‚õà"
        };

        const emoji = icons[iconCode] || "‚ùì";
        document.getElementById('weather').textContent = `${emoji} ${temp}¬∞C`;
      } catch {
        document.getElementById('weather').textContent = "üåê Weather error";
      }
    }

    // Get user location
    function getLocationAndWeather() {
      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            fetchWeather(position.coords.latitude, position.coords.longitude);
          },
          () => {
            document.getElementById('weather').textContent = "üìç Location blocked";
          }
        );
      } else {
        document.getElementById('weather').textContent = "üìç Geolocation not available";
      }
    }

    getLocationAndWeather();
    setInterval(getLocationAndWeather, 600000); // Refresh weather every 10 minutes
  </script>
</body>
</html>
